mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb))
temps <- climate_data %>%
filter(str_detect(data_key,"temp")) %>%
spread(data_key, data_value) %>%
mutate(temp_high_rec = round(temp_high_rec,0),
temp_low_rec = round(temp_low_rec,0),
temp_high_avg = round(temp_high_avg,0),
temp_low_avg = round(temp_low_avg,0))
precip <- climate_data %>%
filter(str_detect(data_key,paste(c("snow","rain"),collapse = "|")))
sun <- climate_data %>%
filter(str_detect(data_key,"sun")) %>%
spread(data_key, data_value) %>%
mutate(night = case_when(month == "Jan" ~ (31*24)-sun,
month == "Feb" ~ (28*24)-sun,
month == "Mar" ~ (31*24)-sun,
month == "Apr" ~ (30*24)-sun,
month == "May" ~ (31*24)-sun,
month == "Jun" ~ (30*24)-sun,
month == "Jul" ~ (31*24)-sun,
month == "Aug" ~ (31*24)-sun,
month == "Sep" ~ (30*24)-sun,
month == "Oct" ~ (31*24)-sun,
month == "Nov" ~ (30*24)-sun,
month == "Dec" ~ (31*24)-sun)) %>%
gather(data_key, data_value, -location, -month)
write_csv(temps, "weather_comp/temps.csv")
write_csv(precip, "weather_comp/precip.csv")
write_csv(sun, "weather_comp/sun.csv")
runApp('weather_comp')
temps <- climate_data %>%
filter(str_detect(data_key,"temp")) %>%
spread(data_key, data_value) %>%
mutate(temp_high_rec = round(temp_high_rec,0),
temp_low_rec = round(temp_low_rec,0),
temp_high_avg = round(temp_high_avg,0),
temp_low_avg = round(temp_low_avg,0)) %>%
mutate(month = factor(month, levels = month.abb))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,paste(c("mm","inches\\)"),collapse="&") ) == TRUE ~ z*.0393701,
str_detect(data_key,paste(c("cm","inches\\)"),collapse="&") ) == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb))
temps <- climate_data %>%
filter(str_detect(data_key,"temp")) %>%
spread(data_key, data_value) %>%
mutate(temp_high_rec = round(temp_high_rec,0),
temp_low_rec = round(temp_low_rec,0),
temp_high_avg = round(temp_high_avg,0),
temp_low_avg = round(temp_low_avg,0)) %>%
mutate(month = factor(month, levels = month.abb))
precip <- climate_data %>%
filter(str_detect(data_key,paste(c("snow","rain"),collapse = "|")))
sun <- climate_data %>%
filter(str_detect(data_key,"sun")) %>%
spread(data_key, data_value) %>%
mutate(night = case_when(month == "Jan" ~ (31*24)-sun,
month == "Feb" ~ (28*24)-sun,
month == "Mar" ~ (31*24)-sun,
month == "Apr" ~ (30*24)-sun,
month == "May" ~ (31*24)-sun,
month == "Jun" ~ (30*24)-sun,
month == "Jul" ~ (31*24)-sun,
month == "Aug" ~ (31*24)-sun,
month == "Sep" ~ (30*24)-sun,
month == "Oct" ~ (31*24)-sun,
month == "Nov" ~ (30*24)-sun,
month == "Dec" ~ (31*24)-sun)) %>%
gather(data_key, data_value, -location, -month)
write_csv(temps, "weather_comp/temps.csv")
write_csv(precip, "weather_comp/precip.csv")
write_csv(sun, "weather_comp/sun.csv")
runApp('weather_comp')
View(total_diff)
View(ni)
ni <- wrds_nc %>%
filter(ni>0 & ni_gaap>0) %>%
select(conm.x, conm.y, year, ni, ni_gaap) %>%
replace_na(list(ni = 0, ni_gaap = 0)) %>%
mutate(ni_diff = abs(ni - ni_gaap)) %>%
mutate(rank = row_number(desc(ni_diff)))
colnames(wrds_nc)
View(sun)
View(precip)
runApp('weather_comp')
View(climate_data)
climate_data %>% filter(data_key == "percip" | data_key == "rain") %>% View()
climate_data %>% filter(data_key == "percip" | data_key == "rain" | data_key = "snow") %>% View()
climate_data %>% filter(data_key == "percip" | data_key == "rain" | data_key == "snow") %>% View()
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z))))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm (inches)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm (inches)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb)) %>%
filter(data_key == "rain" & data_value > 0) %>%
mutate(data_key = case_when(data_key == "precip" ~ "rain"))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb)) %>%
filter(data_key == "rain" & data_value > 0) %>%
mutate(data_key = case_when(data_key == "rain" ~ "precip"))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb)) %>%
filter(!(data_key == "rain" & data_value == 0)) %>%
mutate(data_key = case_when(data_key == "rain" ~ "precip"))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb)) %>%
filter(!(data_key == "rain" & data_value == 0)) %>%
mutate(data_key = case_when(data_key == "precip" ~ "rain"))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb)) %>%
filter(!(data_key == "rain" & data_value == 0))
climate_data %>% filter(data_key=="rain" | data_key == "precip") %>% View()
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "percip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb)) %>%
filter(!(data_key == "rain" & data_value == 0))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "precip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb)) %>%
filter(!(data_key == "rain" & data_value == 0))
climate_data %>% filter(data_key == "rain" | data_key =="precip")
climate_data %>% filter(data_key == "rain" | data_key =="precip") %>% View()
mutate(data_key = case_when(data_key == "precip" ~ "rain"))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "precip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb)) %>%
filter(!(data_key == "rain" & data_value == 0)) %>%
mutate(data_key = case_when(data_key == "precip" ~ "rain"))
climate_data <- climate_table %>%
mutate(location = paste(city, country, sep = ", ")) %>%
select(-X1, -Year, -city, -country) %>%
gather(data_key, data_value, -location, -Month) %>%
rename(month = data_key,
data_key = Month) %>%
mutate(z = gsub("\\s*\\([^\\)]+\\)", "", data_value)) %>% #remove everything in parentheses
mutate(z = as.numeric(as.character(gsub("−", "-", z)))) %>% #replace wrong minus sign
mutate(y = case_when(str_detect(data_key,"F\\)") == TRUE ~ z*1.8+32,
str_detect(data_key,"mm \\(inches\\)") == TRUE ~ z*.0393701,
str_detect(data_key,"cm \\(inches\\)") == TRUE ~ z*.393701,
TRUE ~ z)) %>%
mutate(y = round(y,4)) %>%
mutate(data_value = y) %>%
select(-z,-y) %>%
mutate(data_key = tolower(data_key)) %>%
filter(!str_detect(data_key,"record high humidex")) %>%
filter(!str_detect(data_key,"record low wind chill")) %>%
mutate(key = case_when(str_detect(data_key,"record high") == TRUE ~ "temp_high_rec",
str_detect(data_key,"record low") == TRUE ~ "temp_low_rec",
str_detect(data_key,"average high") == TRUE ~ "temp_high_avg",
str_detect(data_key,"average low") == TRUE ~ "temp_low_avg",
str_detect(data_key,"daily mean") == TRUE ~ "temp_avg",
str_detect(data_key,"precipitation days") == TRUE ~ "percip_days",
str_detect(data_key,"precipitation") == TRUE ~ "precip",
str_detect(data_key,"rainfall") == TRUE ~ "rain",
str_detect(data_key,"snowfall") == TRUE ~ "snow",
str_detect(data_key,"mean monthly sunshine") == TRUE ~ "sun")) %>%
mutate(data_key = key) %>%
select(-key) %>%
filter(!is.na(data_key)) %>%
mutate(month = factor(month, levels = month.abb)) %>%
filter(!(data_key == "rain" & data_value == 0)) %>%
mutate(data_key = case_when(data_key == "precip" ~ "rain", TRUE))
View(climate_data)
